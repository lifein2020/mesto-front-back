{"ast":null,"code":"var _jsxFileName = \"/Users/svetlana/it/react-mesto-api-full/frontend/src/components/App/App.js\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect } from 'react';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport api from '../../utils/Api';\nimport { CurrentUserContext } from '../../contexts/CurrentUserContext';\nimport kusto from '../../images/kusto.jpg';\nimport PopupWithForm from '../PopupWithForm/PopupWithForm';\nimport EditProfilePopup from '../EditProfilePopup/EditProfilePopup';\nimport EditAvatarPopup from '../EditAvatarPopup/EditAvatarPopup';\nimport AddPlacePopup from '../AddPlacePopup/AddPlacePopup';\nimport ImagePopup from '../ImagePopup/ImagePopup';\nimport Header from '../Header/Header';\nimport Main from '../Main/Main';\nimport Footer from '../Footer/Footer';\nimport Register from '../Register/Register';\nimport Login from '../Login/Login';\nimport InfoTooltip from '../InfoTooltip/InfoTooltip';\nimport ProtectedRoute from '../ProtectedRoute/ProtectedRoute';\nimport * as auth from '../../utils/auth.js';\nimport success from \"../../images/success.svg\";\nimport fail from \"../../images/fail.svg\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  //Для компонента Main:\n  const [isEditProfileOpen, setIsEditProfileOpen] = useState(false);\n\n  const handleEditProfileClick = () => {\n    setIsEditProfileOpen(true);\n  };\n\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n\n  const handleAddPlaceClick = () => {\n    setIsAddPlacePopupOpen(true);\n  };\n\n  const [isEditAvatarOpen, setIsEditAvatarOpen] = useState(false);\n\n  const handleEditAvatarClick = () => {\n    setIsEditAvatarOpen(true);\n  };\n\n  const [selectedCard, setIsSelectedCard] = useState({});\n  const [isPreviewPopupOpened, setIsPreviewPopupOpened] = useState(false);\n\n  function onCardClick(card) {\n    setIsSelectedCard(card);\n    setIsPreviewPopupOpened(true);\n  }\n\n  const [isInfoTooltipOpen, setIsInfoTooltipOpen] = useState(false);\n  const [message, setMessage] = useState({\n    image: \"\",\n    text: \"\"\n  }); //Для компонентов папапов\n\n  const handleAllPopupsClose = () => {\n    setIsEditProfileOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarOpen(false);\n    setIsSelectedCard({});\n    setIsPreviewPopupOpened(false);\n    setIsInfoTooltipOpen(false);\n  }; //Для компонента Main, чтобы потом перебросить в Card через props:\n  //1.\n\n\n  const [currentUser, setCurrentUser] = useState({\n    name: 'Жак-Ив Кусто',\n    about: 'Исследователь океана',\n    avatar: kusto\n  });\n  const [cards, setCards] = useState([]);\n  /*useEffect(() => { \n      const jwt = localStorage.getItem('jwt');\n      console.log(jwt)\n      if (jwt) {\n        return auth.getContent(jwt)\n        .then ((res) => {\n          console.log(res);\n          if(res) {\n            Promise.all([api.getUserInfo(), api.getCardsList()]) //получаем данные с сервера\n            .then(([userData, cardsArray]) => { // передаем эти данные для отрисовки на странице, см в консоли формат в котором приходят. Если правильно передали, то в Main передадуться чнрез props\n              console.log(userData);\n              //if (userData.statusCode === 200) {\n                setCurrentUser({\n                  name: userData.data.name, \n                  about: userData.data.about, \n                  avatar: userData.data.avatar,\n                  _id: userData.data._id,\n                });\n                setCards(cardsArray.data);\n              //} else {\n              //  return\n              //}\n            })\n            .catch((err) => {\n              console.log(err);\n            })\n          }\n          \n        })\n    } \n  }, []);\n  */\n\n  /*const history = useHistory();\n  \n    useEffect(() => { \n      const jwt = localStorage.getItem('jwt');\n      console.log(jwt)\n      if (jwt) {\n        return auth.getContent(jwt)\n        .then ((userData) => {\n          console.log(userData)\n          setCurrentUser({\n            name: userData.data.name, \n            about: userData.data.about, \n            avatar: userData.data.avatar,\n            _id: userData.data._id,\n          });\n          setUserEmail(userData.data.email);\n          if(userData) {\n            history.push('/');\n            Promise.all([api.getCardsList()]) //получаем данные с сервера\n            .then(([cardsArray]) => { // передаем эти данные для отрисовки на странице, см в консоли формат в котором приходят. Если правильно передали, то в Main передадуться чнрез props\n                setCards(cardsArray.data);\n            })\n          } else {\n            return\n          }\n        })\n        .catch((err) => {\n          console.log(err);\n        })\n      }\n  }, [history]);\n  */\n\n  /* if (token) {\n    Promise.all([api.getUserInfo(), api.getCardsList()]) //получаем данные с сервера\n    .then(([userData, cardsArray]) => { // передаем эти данные для отрисовки на странице, см в консоли формат в котором приходят. Если правильно передали, то в Main передадуться чнрез props\n  \n      if (userData.statusCode === 200) {\n        setCurrentUser({\n          name: userData.data.name, \n          about: userData.data.about, \n          avatar: userData.data.avatar,\n          _id: userData.data._id,\n        });\n        setCards(cardsArray.data);\n      } else {\n        return\n      }\n    })\n    .catch((err) => {\n      console.log(err);\n    })\n  }\n   }, []); */\n\n  /*const authUserQ = (jwt) => {\n    console.log(jwt);\n    return auth.getContent(jwt)\n    .then((userData) => {\n      //console.log(userData)\n      if (userData) {\n        setCurrentUser({\n          name: userData.data.name, \n          about: userData.data.about, \n          avatar: userData.data.avatar,\n          _id: userData.data._id,\n        });\n        // setCards(cardsArray.data);\n      }\n    })\n    .catch(err => console.log(err));\n  };\n  \n    useEffect(() => {\n      const jwt = localStorage.getItem('jwt');\n      // console.log(jwt);\n      if (jwt) {\n        authUserQ(jwt);\n      }\n    }, [currentUser]); \n    */\n\n  /*useEffect(() => { \n    Promise.all([api.getUserInfo(), api.getCardsList()]) //получаем данные с сервера\n    .then(([userData, cardsArray]) => { // передаем эти данные для отрисовки на странице, см в консоли формат в котором приходят. Если правильно передали, то в Main передадуться чнрез props\n        setCurrentUser({\n          name: userData.data.name, \n          about: userData.data.about, \n          avatar: userData.data.avatar,\n          _id: userData.data._id,\n        });\n        setCards(cardsArray.data);\n    })\n    .catch((err) => {\n      console.log(err);\n    })\n  }, []);\n  */\n  //3.\n\n  const handleCardLike = card => {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    //const isLiked = card.likes.some(i => i._id === currentUser._id); // из 12спринта\n    const isLiked = card.likes.some(i => i === currentUser._id);\n    console.log(isLiked); // Отправляем запрос в API и получаем обновлённые данные карточки\n\n    api.changeLikeCardStatus(card._id, isLiked).then(newCard => {\n      //console.log(newCard)\n      //setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n      setCards(state => state.map(c => c === card._id ? newCard : c));\n    }).catch(err => {\n      console.log(err);\n    });\n  }; //4.\n\n\n  const handleCardDelete = card => {\n    api.deleteCard(card._id).then(() => {\n      setCards(state => state.filter(c => c._id !== card._id));\n    }).catch(err => {\n      console.log(err);\n    });\n  }; //Для компонента EditProfilePopup\n\n\n  const handleUpdateUser = ({\n    userName,\n    userDescription\n  }) => {\n    // отправляем значения инпутов(то, что ввели)\n    api.patchUserInfo({\n      userName,\n      userDescription\n    }).then(dataProfile => {\n      //console.log(dataProfile)\n      setCurrentUser({\n        name: dataProfile.data.name,\n        about: dataProfile.data.about,\n        avatar: dataProfile.data.avatar,\n        // чтобы аватар тоже отображался \n        likes: dataProfile.data.likes,\n        _id: dataProfile.data._id //чтобы лайки проставлялись после обновления профиля\n\n      }); //handleAllPopupsClose();\n    }).then(() => {\n      handleAllPopupsClose();\n    }).catch(err => {\n      console.log(err);\n    });\n  }; //Для компонента EditAvatarPopup\n\n\n  const handleUpdateAvatar = ({\n    avatarUrl\n  }) => {\n    //отправляем то, что ввели в инпут\n    api.patchAvatarUser({\n      avatarUrl\n    }).then(dataProfile => {\n      // console.log(dataProfile);\n      setCurrentUser({\n        avatar: dataProfile.data.avatar,\n        //чтобы данные профиля тоже отображались \n        name: dataProfile.data.name,\n        about: dataProfile.data.about,\n        _id: dataProfile.data._id\n      });\n      handleAllPopupsClose();\n    }).catch(err => {\n      console.log(err);\n    });\n  }; //Для компонента AddPlacePopup\n\n\n  function handleAddPlaceSubmit({\n    card_name,\n    card_image_link\n  }) {\n    api.postAddCard({\n      card_name,\n      card_image_link\n    }).then(newCard => {\n      console.log(newCard);\n      setCards([newCard.data, ...cards]);\n      handleAllPopupsClose();\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  useEffect(() => {\n    const closeByEscape = e => {\n      if (e.key === 'Escape') {\n        handleAllPopupsClose();\n      }\n    };\n\n    document.addEventListener('keydown', closeByEscape);\n    return () => document.removeEventListener('keydown', closeByEscape);\n  }, []);\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [userEmail, setUserEmail] = useState('email');\n  const history = useHistory();\n\n  const authUser = jwt => {\n    // console.log(jwt);\n    return auth.getContent(jwt).then(res => {\n      console.log(res);\n\n      if (res) {\n        setLoggedIn(true); //setUserEmail(res.data.email);\n      }\n    }).catch(err => console.log(err));\n  }; // если у пользователя есть токен в localStorage, проверит валидность токена\n\n\n  useEffect(() => {\n    const jwt = localStorage.getItem('jwt'); // console.log(jwt);\n\n    if (jwt) {\n      authUser(jwt);\n    }\n  }, [loggedIn]); //если пользователь авторизован, проходит в систему\n\n  useEffect(() => {\n    if (loggedIn) {\n      history.push('/');\n      Promise.all([api.getUserInfo(), api.getCardsList()]) //получаем данные с сервера\n      .then(([userData, cardsArray]) => {\n        // передаем эти данные для отрисовки на странице, см в консоли формат в котором приходят. Если правильно передали, то в Main передадуться чнрез props\n        setCurrentUser({\n          name: userData.data.name,\n          about: userData.data.about,\n          avatar: userData.data.avatar,\n          _id: userData.data._id\n        });\n        setCards(cardsArray.data);\n        setUserEmail(userData.data.email);\n        setCards(cardsArray.data);\n      }).catch(err => {\n        console.log(err);\n      });\n    }\n  }, [loggedIn, history]);\n\n  const handleRegister = ({\n    password,\n    email\n  }) => {\n    return auth.register(password, email).then(dataReg => {\n      console.log(dataReg);\n\n      if (dataReg.data._id || dataReg.statusCode !== 400) {\n        // setUserEmail(dataReg.data.email);\n        history.push('/sign-in');\n        setIsInfoTooltipOpen(true);\n        setMessage({\n          image: success,\n          text: 'Вы успешно зарегистрировались!'\n        });\n      } else {\n        return;\n      }\n    }).catch(err => {\n      setIsInfoTooltipOpen(true);\n      setMessage({\n        image: fail,\n        text: 'Что-то пошло не так! Попробуйте ещё раз.'\n      });\n    });\n  };\n\n  const handleLogin = ({\n    password,\n    email\n  }) => {\n    return auth.authorize(password, email).then(dataLog => {\n      // console.log(dataLog);\n      if (dataLog.token) {\n        // || dataLog.statusCode === 200\n        setLoggedIn(true); //чтобы ProtectedRoute отображал маршрут /\n\n        localStorage.setItem('jwt', dataLog.token);\n        history.push('/'); //очищаем стейт и перенаправляем пользователя на страницу /\n\n        setUserEmail(dataLog.data.email);\n      } else {\n        return;\n      }\n    }).catch(err => {\n      setIsInfoTooltipOpen(true);\n      setMessage({\n        image: fail,\n        text: 'Что-то пошло не так! Попробуйте ещё раз.'\n      });\n    });\n  };\n\n  const onSignOut = () => {\n    localStorage.removeItem('jwt');\n    setLoggedIn(false);\n    history.push('/login');\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"page\",\n      children: /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n        value: currentUser,\n        children: [/*#__PURE__*/_jsxDEV(Header, {\n          onSignOut: onSignOut,\n          email: userEmail\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 398,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Switch, {\n          children: [/*#__PURE__*/_jsxDEV(ProtectedRoute, {\n            exact: true,\n            path: \"/\",\n            loggedIn: loggedIn,\n            component: Main,\n            onEditProfile: handleEditProfileClick,\n            onAddPlace: handleAddPlaceClick,\n            onEditAvatar: handleEditAvatarClick,\n            cards: cards,\n            onCardClick: onCardClick,\n            onLikeClick: handleCardLike,\n            onDeleteClick: handleCardDelete\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 403,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/sign-up\",\n            children: /*#__PURE__*/_jsxDEV(Register, {\n              onRegister: handleRegister\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 417,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/sign-in\",\n            children: /*#__PURE__*/_jsxDEV(Login, {\n              onLogin: handleLogin\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 420,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 419,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            children: loggedIn ? /*#__PURE__*/_jsxDEV(Redirect, {\n              to: \"/sign-in\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 423,\n              columnNumber: 25\n            }, this) : /*#__PURE__*/_jsxDEV(Redirect, {\n              to: \"/sign-up\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 423,\n              columnNumber: 54\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 422,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 402,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 427,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n          isOpen: isEditProfileOpen,\n          onClose: handleAllPopupsClose //currentUser={currentUser}\n          ,\n          onUpdateUser: handleUpdateUser\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 429,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n          isOpen: isAddPlacePopupOpen,\n          onClose: handleAllPopupsClose,\n          onAddPlace: handleAddPlaceSubmit\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 437,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(PopupWithForm, {\n          name: \"confirm\",\n          id: \"formConfirm\",\n          title: \"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",\n          button: \"button_confirm popup__save\",\n          titleButton: \"\\u0414\\u0430\",\n          onClose: handleAllPopupsClose\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 444,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n          isOpen: isEditAvatarOpen,\n          onClose: handleAllPopupsClose,\n          onUpdateAvatar: handleUpdateAvatar\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 453,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n          card: selectedCard,\n          onClose: handleAllPopupsClose,\n          active: isPreviewPopupOpened\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 460,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(InfoTooltip, {\n          isOpen: isInfoTooltipOpen,\n          onClose: handleAllPopupsClose,\n          message: message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 465,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 397,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 396,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n}\n\n_s(App, \"zgwg2CtndEvaQTzNsI7CE4uLleI=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/svetlana/it/react-mesto-api-full/frontend/src/components/App/App.js"],"names":["useState","useEffect","Route","Switch","Redirect","useHistory","api","CurrentUserContext","kusto","PopupWithForm","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ImagePopup","Header","Main","Footer","Register","Login","InfoTooltip","ProtectedRoute","auth","App","isEditProfileOpen","setIsEditProfileOpen","handleEditProfileClick","isAddPlacePopupOpen","setIsAddPlacePopupOpen","handleAddPlaceClick","isEditAvatarOpen","setIsEditAvatarOpen","handleEditAvatarClick","selectedCard","setIsSelectedCard","isPreviewPopupOpened","setIsPreviewPopupOpened","onCardClick","card","isInfoTooltipOpen","setIsInfoTooltipOpen","message","setMessage","image","text","handleAllPopupsClose","currentUser","setCurrentUser","name","about","avatar","cards","setCards","handleCardLike","isLiked","likes","some","i","_id","console","log","changeLikeCardStatus","then","newCard","state","map","c","catch","err","handleCardDelete","deleteCard","filter","handleUpdateUser","userName","userDescription","patchUserInfo","dataProfile","data","handleUpdateAvatar","avatarUrl","patchAvatarUser","handleAddPlaceSubmit","card_name","card_image_link","postAddCard","closeByEscape","e","key","document","addEventListener","removeEventListener","loggedIn","setLoggedIn","userEmail","setUserEmail","history","authUser","jwt","getContent","res","localStorage","getItem","push","Promise","all","getUserInfo","getCardsList","userData","cardsArray","email","handleRegister","password","register","dataReg","statusCode","success","fail","handleLogin","authorize","dataLog","token","setItem","onSignOut","removeItem"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react';\nimport {\n  Route,\n  Switch,\n  Redirect,\n  useHistory\n} from 'react-router-dom';\nimport api from '../../utils/Api';\nimport { CurrentUserContext } from '../../contexts/CurrentUserContext';\nimport kusto from '../../images/kusto.jpg';\nimport PopupWithForm from '../PopupWithForm/PopupWithForm';\nimport EditProfilePopup from '../EditProfilePopup/EditProfilePopup';\nimport EditAvatarPopup from '../EditAvatarPopup/EditAvatarPopup';\nimport AddPlacePopup from '../AddPlacePopup/AddPlacePopup';\nimport ImagePopup from '../ImagePopup/ImagePopup';\nimport Header from '../Header/Header';\nimport Main from '../Main/Main';\nimport Footer from '../Footer/Footer';\nimport Register from '../Register/Register';\nimport Login from '../Login/Login';\nimport InfoTooltip from '../InfoTooltip/InfoTooltip';\nimport ProtectedRoute from '../ProtectedRoute/ProtectedRoute';\nimport * as auth from '../../utils/auth.js';\nimport success from '../../images/success.svg';\nimport fail from '../../images/fail.svg';\n\n\nfunction App() {\n\n  //Для компонента Main:\n  const [isEditProfileOpen, setIsEditProfileOpen] = useState(false);\n  const handleEditProfileClick = () => {\n    setIsEditProfileOpen(true);\n  }\n\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const handleAddPlaceClick = () => {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  const [isEditAvatarOpen, setIsEditAvatarOpen] = useState(false);\n  const handleEditAvatarClick = () => {\n    setIsEditAvatarOpen(true);\n  }\n\n  const [selectedCard, setIsSelectedCard] = useState({});\n  const [isPreviewPopupOpened, setIsPreviewPopupOpened] = useState(false);\n  function onCardClick(card) {\n    setIsSelectedCard(card);\n    setIsPreviewPopupOpened(true);\n  }\n\n  const [isInfoTooltipOpen, setIsInfoTooltipOpen] = useState(false);\n  const [message, setMessage] = useState({image: \"\", text: \"\"});\n\n  //Для компонентов папапов\n  const handleAllPopupsClose = () => {\n    setIsEditProfileOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarOpen(false);\n    setIsSelectedCard({});\n    setIsPreviewPopupOpened(false);\n    setIsInfoTooltipOpen(false);\n  }\n\n  //Для компонента Main, чтобы потом перебросить в Card через props:\n  //1.\n  const [currentUser, setCurrentUser] = useState({name: 'Жак-Ив Кусто', about: 'Исследователь океана', avatar: kusto});\n  const [cards, setCards] = useState([]);\n  \n  /*useEffect(() => { \n      const jwt = localStorage.getItem('jwt');\n      console.log(jwt)\n      if (jwt) {\n        return auth.getContent(jwt)\n        .then ((res) => {\n          console.log(res);\n          if(res) {\n            Promise.all([api.getUserInfo(), api.getCardsList()]) //получаем данные с сервера\n            .then(([userData, cardsArray]) => { // передаем эти данные для отрисовки на странице, см в консоли формат в котором приходят. Если правильно передали, то в Main передадуться чнрез props\n              console.log(userData);\n              //if (userData.statusCode === 200) {\n                setCurrentUser({\n                  name: userData.data.name, \n                  about: userData.data.about, \n                  avatar: userData.data.avatar,\n                  _id: userData.data._id,\n                });\n                setCards(cardsArray.data);\n              //} else {\n              //  return\n              //}\n            })\n            .catch((err) => {\n              console.log(err);\n            })\n          }\n          \n        })\n    } \n  }, []);\n*/\n/*const history = useHistory();\n\n  useEffect(() => { \n    const jwt = localStorage.getItem('jwt');\n    console.log(jwt)\n    if (jwt) {\n      return auth.getContent(jwt)\n      .then ((userData) => {\n        console.log(userData)\n        setCurrentUser({\n          name: userData.data.name, \n          about: userData.data.about, \n          avatar: userData.data.avatar,\n          _id: userData.data._id,\n        });\n        setUserEmail(userData.data.email);\n        if(userData) {\n          history.push('/');\n          Promise.all([api.getCardsList()]) //получаем данные с сервера\n          .then(([cardsArray]) => { // передаем эти данные для отрисовки на странице, см в консоли формат в котором приходят. Если правильно передали, то в Main передадуться чнрез props\n              setCards(cardsArray.data);\n          })\n        } else {\n          return\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n      })\n    }\n}, [history]);\n*/\n\n\n      /* if (token) {\n        Promise.all([api.getUserInfo(), api.getCardsList()]) //получаем данные с сервера\n        .then(([userData, cardsArray]) => { // передаем эти данные для отрисовки на странице, см в консоли формат в котором приходят. Если правильно передали, то в Main передадуться чнрез props\n      \n          if (userData.statusCode === 200) {\n            setCurrentUser({\n              name: userData.data.name, \n              about: userData.data.about, \n              avatar: userData.data.avatar,\n              _id: userData.data._id,\n            });\n            setCards(cardsArray.data);\n          } else {\n            return\n          }\n        })\n        .catch((err) => {\n          console.log(err);\n        })\n      }\n    \n  }, []); */\n\n/*const authUserQ = (jwt) => {\n  console.log(jwt);\n  return auth.getContent(jwt)\n  .then((userData) => {\n    //console.log(userData)\n    if (userData) {\n      setCurrentUser({\n        name: userData.data.name, \n        about: userData.data.about, \n        avatar: userData.data.avatar,\n        _id: userData.data._id,\n      });\n      // setCards(cardsArray.data);\n    }\n  })\n  .catch(err => console.log(err));\n};\n\n  useEffect(() => {\n    const jwt = localStorage.getItem('jwt');\n    // console.log(jwt);\n    if (jwt) {\n      authUserQ(jwt);\n    }\n  }, [currentUser]); \n  */\n\n  /*useEffect(() => { \n    Promise.all([api.getUserInfo(), api.getCardsList()]) //получаем данные с сервера\n    .then(([userData, cardsArray]) => { // передаем эти данные для отрисовки на странице, см в консоли формат в котором приходят. Если правильно передали, то в Main передадуться чнрез props\n        setCurrentUser({\n          name: userData.data.name, \n          about: userData.data.about, \n          avatar: userData.data.avatar,\n          _id: userData.data._id,\n        });\n        setCards(cardsArray.data);\n    })\n    .catch((err) => {\n      console.log(err);\n    })\n  }, []);\n*/\n  //3.\n  const handleCardLike = (card) => {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    //const isLiked = card.likes.some(i => i._id === currentUser._id); // из 12спринта\n     const isLiked = card.likes.some(i => i === currentUser._id); \n    console.log(isLiked);\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    api.changeLikeCardStatus(card._id, isLiked)\n    .then((newCard) => {\n      //console.log(newCard)\n        //setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n        setCards((state) => state.map((c) => c === card._id ? newCard : c));\n    })\n    .catch((err) => {\n      console.log(err);\n    })\n  }\n\n  //4.\n  const handleCardDelete = (card) => {\n    api.deleteCard(card._id)\n    .then(() => {\n        setCards((state) =>  state.filter((c) => c._id !== card._id));\n    })\n    .catch((err) => {\n      console.log(err);\n    })\n  }\n\n  //Для компонента EditProfilePopup\n  const handleUpdateUser = ({userName, userDescription}) => {\n    // отправляем значения инпутов(то, что ввели)\n    api.patchUserInfo({userName, userDescription}) \n    .then((dataProfile) => {\n      //console.log(dataProfile)\n      setCurrentUser({\n        name: dataProfile.data.name, \n        about: dataProfile.data.about,\n        avatar: dataProfile.data.avatar, // чтобы аватар тоже отображался \n        likes: dataProfile.data.likes,\n        _id: dataProfile.data._id, //чтобы лайки проставлялись после обновления профиля\n      });\n      //handleAllPopupsClose();\n    })\n    .then(() => {\n      handleAllPopupsClose();\n    })\n    .catch((err) => {\n      console.log(err);\n    }) \n  }\n\n  //Для компонента EditAvatarPopup\n  const handleUpdateAvatar = ({ avatarUrl }) => {\n    //отправляем то, что ввели в инпут\n    api.patchAvatarUser({ avatarUrl })\n    \n    .then((dataProfile) => {\n     // console.log(dataProfile);\n      setCurrentUser({\n        avatar: dataProfile.data.avatar,\n        //чтобы данные профиля тоже отображались \n        name: dataProfile.data.name, \n        about: dataProfile.data.about,\n        _id: dataProfile.data._id,\n      });\n      handleAllPopupsClose();\n    })\n    .catch((err) => {\n      console.log(err);\n    })\n  }\n\n  //Для компонента AddPlacePopup\n  function handleAddPlaceSubmit({ card_name, card_image_link }) {\n    api.postAddCard({ card_name, card_image_link })\n    .then(newCard => {\n      console.log(newCard)\n      setCards([newCard.data, ...cards]);\n      handleAllPopupsClose();\n    })\n    .catch((err) => {\n      console.log(err);\n    })\n  }\n\n  useEffect(() => {\n    const closeByEscape = (e) => {\n      if (e.key === 'Escape') {\n        handleAllPopupsClose();\n      }\n  }\n    document.addEventListener('keydown', closeByEscape)\n    return () => document.removeEventListener('keydown', closeByEscape)\n  }, [])\n\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [userEmail, setUserEmail] = useState('email');\n  const history = useHistory();\n  \n\n  const authUser = (jwt) => {\n    // console.log(jwt);\n    return auth.getContent(jwt)\n    .then((res) => {\n      console.log(res)\n      if (res) {\n        setLoggedIn(true);\n        //setUserEmail(res.data.email);\n      }\n    })\n    .catch(err => console.log(err));\n  };\n\n  // если у пользователя есть токен в localStorage, проверит валидность токена\n  useEffect(() => {\n    const jwt = localStorage.getItem('jwt');\n    // console.log(jwt);\n    if (jwt) {\n      authUser(jwt);\n    }\n  }, [loggedIn]);\n\n  //если пользователь авторизован, проходит в систему\n  useEffect(() => {\n    if (loggedIn) {\n      history.push('/');\n      Promise.all([api.getUserInfo(), api.getCardsList()]) //получаем данные с сервера\n      .then(([userData, cardsArray]) => { // передаем эти данные для отрисовки на странице, см в консоли формат в котором приходят. Если правильно передали, то в Main передадуться чнрез props\n          setCurrentUser({\n            name: userData.data.name, \n            about: userData.data.about, \n            avatar: userData.data.avatar,\n            _id: userData.data._id,\n          });\n          setCards(cardsArray.data);\n          setUserEmail(userData.data.email);\n          setCards(cardsArray.data);\n      })\n      .catch((err) => {\n        console.log(err);\n      })\n    }\n  }, [loggedIn, history]);\n\n  const handleRegister = ({ password, email }) => {\n    return auth.register(password, email)\n    .then(dataReg => {\n       console.log(dataReg);\n      if (dataReg.data._id || dataReg.statusCode !== 400) {\n        // setUserEmail(dataReg.data.email);\n        history.push('/sign-in');\n        setIsInfoTooltipOpen(true);\n        setMessage({ image: success, text: 'Вы успешно зарегистрировались!' });\n      } else {\n        return\n      }\n    })\n    .catch( err => {\n      setIsInfoTooltipOpen(true);\n      setMessage({ image: fail, text: 'Что-то пошло не так! Попробуйте ещё раз.' });\n      }\n    )\n  };\n\n  const handleLogin = ({ password, email }) => {\n    return auth.authorize(password, email)\n    .then(dataLog => {\n      // console.log(dataLog);\n      if (dataLog.token) { // || dataLog.statusCode === 200\n        setLoggedIn(true); //чтобы ProtectedRoute отображал маршрут /\n        localStorage.setItem('jwt', dataLog.token);\n        history.push('/'); //очищаем стейт и перенаправляем пользователя на страницу /\n        setUserEmail(dataLog.data.email);\n      } else {\n          return\n      }\n    })\n    .catch( err => {\n      setIsInfoTooltipOpen(true);\n      setMessage({ image: fail, text: 'Что-то пошло не так! Попробуйте ещё раз.' });\n      }\n    )\n  };\n\n  const onSignOut = () => {\n    localStorage.removeItem('jwt');\n    setLoggedIn(false);\n    history.push('/login');\n  }\n\n  return (\n    <>\n      <div className=\"page\">\n        <CurrentUserContext.Provider value={currentUser}>\n          <Header \n              onSignOut={onSignOut}\n              email={userEmail}\n          />\n          <Switch>\n            <ProtectedRoute \n              exact \n              path=\"/\" \n              loggedIn={loggedIn} \n              component={Main} \n              onEditProfile={handleEditProfileClick}\n              onAddPlace={handleAddPlaceClick}\n              onEditAvatar={handleEditAvatarClick}\n              cards={cards}\n              onCardClick={onCardClick}\n              onLikeClick={handleCardLike}\n              onDeleteClick={handleCardDelete}\n            />\n            <Route path=\"/sign-up\">\n              <Register onRegister={handleRegister} />\n            </Route>\n            <Route path=\"/sign-in\">\n              <Login onLogin={handleLogin} />\n            </Route>\n            <Route>\n            {loggedIn ? <Redirect to=\"/sign-in\" /> : <Redirect to=\"/sign-up\" />}\n            </Route>\n          </Switch>\n\n          <Footer />\n          \n          <EditProfilePopup\n          isOpen={isEditProfileOpen}\n          onClose={handleAllPopupsClose}\n          //currentUser={currentUser}\n          onUpdateUser={handleUpdateUser}\n          >\n          </EditProfilePopup>\n\n          <AddPlacePopup\n            isOpen={isAddPlacePopupOpen}\n            onClose={handleAllPopupsClose}\n            onAddPlace={handleAddPlaceSubmit}\n          >\n          </AddPlacePopup>\n\n          <PopupWithForm\n            name=\"confirm\"\n            id=\"formConfirm\"\n            title=\"Вы уверены?\"\n            button=\"button_confirm popup__save\"\n            titleButton=\"Да\"\n            onClose={handleAllPopupsClose}\n          />\n\n          <EditAvatarPopup\n            isOpen={isEditAvatarOpen}\n            onClose={handleAllPopupsClose}\n            onUpdateAvatar={handleUpdateAvatar}\n          >\n          </EditAvatarPopup>\n\n          <ImagePopup card={selectedCard}\n            onClose={handleAllPopupsClose}\n            active={isPreviewPopupOpened}\n          />\n\n          <InfoTooltip \n            isOpen={isInfoTooltipOpen}\n            onClose={handleAllPopupsClose}\n            message={message}\n          />\n        </CurrentUserContext.Provider>\n      </div>\n    </>\n  )\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}